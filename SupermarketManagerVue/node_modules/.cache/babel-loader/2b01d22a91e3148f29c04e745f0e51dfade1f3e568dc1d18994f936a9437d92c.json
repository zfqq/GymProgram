{"ast":null,"code":"import { forbiddenRole, roleList, edit_role, save_role, checkPermissons, saveRolePermissons } from \"@/api/system/role/roleApi\";\nimport { ajaxPost, popup } from \"@/assets/js/common\";\nexport default {\n  data() {\n    return {\n      tableData: [],\n      editRoleForm: {},\n      editRoleRow: {},\n      dialogVisible: false,\n      newRoleVisable: false,\n      distributionFulVisable: false,\n      newRoleForm: {},\n      roleSearchForm: {},\n      distributionFulForm: {},\n      options: [{\n        label: '正常',\n        value: '0'\n      }, {\n        label: '停用',\n        value: '-1'\n      }],\n      /*职能分配*/\n      props: {\n        multiple: true\n      },\n      fuloptions: [],\n      default_checked_mid: [],\n      filterText: '',\n      rules: {\n        name: [{\n          required: true,\n          message: '名称不能为空',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  watch: {\n    filterText(val) {\n      this.$refs.tree.filter(val);\n    }\n  },\n  methods: {\n    filterNode(value, data) {\n      if (!value) return true;\n      return data.label.indexOf(value) !== -1;\n    },\n    init() {\n      roleList(this.roleSearchForm).then(res => {\n        res = res.data;\n        if (res.code = 200) {\n          popup(\"操作成功\");\n          this.tableData = res.data;\n        } else {\n          popup(res.msg, \"error\");\n        }\n      });\n    },\n    forbidden(id) {\n      forbiddenRole(id).then(res => {\n        res = res.data;\n        if (res.code == 200) {\n          this.roleSearchForm.state = '0';\n          this.init();\n          popup(\"操作成功\");\n        } else {\n          popup(res.msg, \"error\");\n        }\n      });\n    },\n    /*弹出修改表单*/\n    editRole(row) {\n      this.editRoleForm = {\n        ...row\n      };\n      this.editRoleRow = {\n        ...row\n      };\n      this.dialogVisible = true;\n    },\n    /*条件搜索*/\n    subSearchForm() {\n      this.init();\n    },\n    /*对接后端修改角色接口*/\n    submitEditForm() {\n      if (this.editRoleForm.info == this.editRoleRow.info && this.editRoleForm.state == this.editRoleRow.state) {\n        popup(\"您没有更改内容\", \"warning\");\n        return;\n      }\n      edit_role(this.editRoleForm).then(res => {\n        res = res.data;\n        if (res.code == 200) {\n          popup(\"操作成功\");\n          this.editRoleForm = {};\n          this.editRoleRow = {};\n          this.dialogVisible = false;\n          this.roleSearchForm.state = '0';\n          this.init();\n        } else {\n          popup(res.msg, \"error\");\n        }\n      });\n    },\n    /*修改角色重置按钮*/\n    resetEditForm() {\n      this.editRoleForm = {\n        ...this.editRoleRow\n      };\n    },\n    /*创建新角色*/\n    submitNewForm(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          console.log(this.newRoleForm);\n          save_role(this.newRoleForm).then(res => {\n            res = res.data;\n            if (res.code == 200) {\n              popup(\"操作成功\");\n              this.newRoleForm = {};\n              this.newRoleVisable = false;\n              this.init();\n            } else {\n              popup(res.msg, \"error\");\n            }\n          });\n        }\n      });\n    },\n    resetNewForm() {\n      this.newRoleForm = {};\n    },\n    /*职能分配*/\n    /*授权按钮*/\n    checkPermissons(rid) {\n      this.distributionFulForm.rid = rid;\n      this.default_checked_mid = [];\n      checkPermissons(rid).then(res => {\n        res = res.data;\n        if (res.code == 200) {\n          popup(\"操作成功\");\n          this.fuloptions = res.data.menus;\n          this.default_checked_mid = res.data.menuIds.sort((x, y) => x - y);\n          console.log(typeof this.default_checked_mid);\n          console.log(this.default_checked_mid);\n        } else {\n          popup(res.msg, \"error\");\n        }\n      });\n      this.distributionFulVisable = true;\n    },\n    submitDistributionFulForm() {\n      var keys = this.$refs.tree.getCheckedKeys();\n      var v = JSON.stringify(keys).replace(\"[\", \"\").replace(\"]\", \"\");\n      this.distributionFulForm.menuIds = v;\n      console.log(this.distributionFulForm.menuIds);\n      saveRolePermissons(this.distributionFulForm).then(res => {\n        res = res.data;\n        if (res.code == 200) {\n          popup(\"操作成功\");\n          this.distributionFulVisable = false;\n          this.distributionFulForm = {};\n          this.default_checked_mid = [];\n          this.fuloptions = [];\n        } else {\n          popup(res.msg, \"error\");\n        }\n      });\n      this.distributionFulVisable = false;\n    },\n    celDistributionFul() {\n      this.default_checked_mid = [];\n      this.fuloptions = [];\n      this.distributionFulForm = {};\n      this.distributionFulVisable = false;\n    }\n  },\n  created() {\n    this.init();\n  }\n};","map":{"version":3,"names":["forbiddenRole","roleList","edit_role","save_role","checkPermissons","saveRolePermissons","ajaxPost","popup","data","tableData","editRoleForm","editRoleRow","dialogVisible","newRoleVisable","distributionFulVisable","newRoleForm","roleSearchForm","distributionFulForm","options","label","value","props","multiple","fuloptions","default_checked_mid","filterText","rules","name","required","message","trigger","watch","val","$refs","tree","filter","methods","filterNode","indexOf","init","then","res","code","msg","forbidden","id","state","editRole","row","subSearchForm","submitEditForm","info","resetEditForm","submitNewForm","formName","validate","valid","console","log","resetNewForm","rid","menus","menuIds","sort","x","y","submitDistributionFulForm","keys","getCheckedKeys","v","JSON","stringify","replace","celDistributionFul","created"],"sources":["src/views/system/role/List.vue"],"sourcesContent":["<template>\n    <div id=\"role_list\">\n        <!--条件搜索-->\n        <div class=\"search\">\n            <div class=\"column\">\n                <span>名称：</span>\n                <el-input style=\"height: 21px;width: 136px\" placeholder=\"角色名称\" v-model=\"roleSearchForm.name\"/>\n            </div>\n            <div class=\"column\">\n                <span>状态：</span>\n                <el-select style=\"width: 200px\" @change=\"$forceUpdate\" v-model=\"roleSearchForm.state\" placeholder=\"请选择状态\" clearable>\n                    <el-option label=\"正常\" value=\"0\"></el-option>\n                    <el-option label=\"停用\" value=\"-1\"></el-option>\n                </el-select>\n            </div>\n            <div class=\"column\">\n                <el-button type=\"success\" @click=\"subSearchForm('ruleForm')\">搜索</el-button>\n                <el-button type=\"danger\" @click=\"newRoleVisable=true\">创建</el-button>\n\n            </div>\n        </div>\n        <el-table\n                :data=\"tableData\"\n                style=\"width: 100%\">\n            <el-table-column\n                    type=\"index\"\n                    label=\"序号\"\n                    width=\"180\">\n            </el-table-column>\n            <el-table-column\n                    prop=\"name\"\n                    label=\"名称\"\n                    width=\"180\">\n            </el-table-column>\n            <el-table-column\n                    prop=\"info\"\n                    label=\"描述\">\n            </el-table-column>\n            <el-table-column\n                    prop=\"state\"\n                    label=\"状态\">\n                <template v-slot=\"scope\">\n                    <el-tag v-if=\"scope.row.state=='0'\" type=\"success\">正常</el-tag>\n                    <el-tag v-else type=\"danger\">停用</el-tag>\n                </template>\n            </el-table-column>\n            <el-table-column\n                    label=\"操作\">\n                <template v-slot=\"scope\">\n                    <el-button size=\"mini\" type=\"warning\" @click=\"editRole(scope.row)\" plain>修改</el-button>\n                    <el-button size=\"mini\" type=\"danger\" @click=\"forbidden(scope.row.id)\" plain>停用</el-button>\n                    <el-button size=\"mini\" type=\"primary\" @click=\"checkPermissons(scope.row.id)\" plain>授权</el-button>\n                </template>\n            </el-table-column>\n        </el-table>\n        <!--修改描述/状态弹出框-->\n        <el-dialog\n                title=\"角色信息修改\"\n                :visible.sync=\"dialogVisible\"\n                width=\"50%\">\n            <el-form v-model=\"editRoleForm\"  label-width=\"100px\" class=\"demo-ruleForm\">\n                <el-form-item label=\"名称：\">\n                    <el-input disabled v-model=\"editRoleForm.name\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"描述：\">\n                    <el-input type=\"text\" v-model=\"editRoleForm.info\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"状态：\">\n                    <el-select v-model=\"editRoleForm.state\"\n                               clearable\n                               @change=\"$forceUpdate()\"\n                               placeholder=\"请选择状态\">\n                        <el-option\n                                v-for=\"item in options\"\n                                :key=\"item.value\"\n                                :label=\"item.label\"\n                                :value=\"item.value\">\n                        </el-option>\n                    </el-select>\n                </el-form-item>\n                <el-form-item>\n                    <el-button type=\"primary\" @click=\"submitEditForm\">提交</el-button>\n                    <el-button @click=\"resetEditForm\">重置</el-button>\n                </el-form-item>\n            </el-form>\n        </el-dialog>\n        <!--创建角色弹出框-->\n        <el-dialog\n                title=\"创建角色\"\n                :visible.sync=\"newRoleVisable\"\n                width=\"50%\">\n            <el-form :model=\"newRoleForm\" :rules=\"rules\" ref=\"newRoleForm\"  label-width=\"100px\" class=\"demo-ruleForm\">\n                <el-form-item label=\"名称：\" prop=\"name\">\n                    <el-input v-model=\"newRoleForm.name\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"描述：\">\n                    <el-input type=\"text\" v-model=\"newRoleForm.info\"></el-input>\n                </el-form-item>\n                <el-form-item>\n                    <el-button type=\"primary\" @click=\"submitNewForm('newRoleForm')\">提交</el-button>\n                    <el-button @click=\"resetNewForm\">重置</el-button>\n                </el-form-item>\n            </el-form>\n        </el-dialog>\n        <!--职能分配框-->\n        <el-dialog\n                title=\"权限分配\"\n                :visible.sync=\"distributionFulVisable\"\n                width=\"50%\">\n            <el-form :model=\"distributionFulForm\" label-width=\"100px\" class=\"demo-ruleForm\">\n                <el-form-item>\n                    <el-input\n                            placeholder=\"输入关键字进行过滤\"\n                            v-model=\"filterText\">\n                    </el-input>\n                    <el-tree\n                            :data=\"fuloptions\"\n                            class=\"filter-tree\"\n                            show-checkbox\n                            node-key=\"value\"\n                            :default-checked-keys=\"default_checked_mid\"\n                            default-expand-all\n                            :filter-node-method=\"filterNode\"\n                            ref=\"tree\"\n                            :props=\"props\"\n                    ></el-tree>\n                </el-form-item>\n                <el-form-item>\n                    <el-button type=\"primary\" @click=\"submitDistributionFulForm\">提交</el-button>\n                    <el-button @click=\"celDistributionFul\">取消</el-button>\n                </el-form-item>\n            </el-form>\n        </el-dialog>\n    </div>\n</template>\n<script>\n    import {\n        forbiddenRole,\n        roleList,\n        edit_role,\n        save_role,\n        checkPermissons,\n        saveRolePermissons\n    } from \"@/api/system/role/roleApi\";\n    import {ajaxPost, popup} from \"@/assets/js/common\";\n\n    export default {\n        data() {\n            return {\n                tableData: [],\n                editRoleForm: {},\n                editRoleRow:{},\n                dialogVisible: false,\n                newRoleVisable:false,\n                distributionFulVisable:false,\n                newRoleForm:{},\n                roleSearchForm: {},\n                distributionFulForm:{\n                },\n                options: [\n                    {label: '正常', value: '0'},\n                    {label: '停用', value: '-1'}\n                ],\n                /*职能分配*/\n                props: { multiple: true },\n                fuloptions: [],\n                default_checked_mid:[],\n                filterText:'',\n                rules: {\n                    name:[\n                        {required: true, message: '名称不能为空', trigger: 'blur'},\n                    ]\n                }\n            }\n        },\n        watch: {\n            filterText(val) {\n                this.$refs.tree.filter(val);\n            }\n        },\n        methods: {\n            filterNode(value, data) {\n                if (!value) return true;\n                return data.label.indexOf(value) !== -1;\n            },\n            init() {\n                roleList(this.roleSearchForm).then(res => {\n                    res = res.data\n                    if (res.code = 200) {\n                        popup(\"操作成功\")\n                        this.tableData = res.data\n                    } else {\n                        popup(res.msg, \"error\")\n                    }\n                })\n            },\n            forbidden(id) {\n                forbiddenRole(id).then(res => {\n                    res = res.data\n                    if (res.code == 200) {\n                        this.roleSearchForm.state='0'\n                        this.init()\n                        popup(\"操作成功\")\n                    } else {\n                        popup(res.msg, \"error\")\n                    }\n                })\n            },\n\n            /*弹出修改表单*/\n            editRole(row) {\n                this.editRoleForm= {...row}\n                this.editRoleRow={...row}\n                this.dialogVisible = true\n            },\n            /*条件搜索*/\n            subSearchForm() {\n                this.init()\n            },\n            /*对接后端修改角色接口*/\n            submitEditForm() {\n                if (this.editRoleForm.info==this.editRoleRow.info && this.editRoleForm.state==this.editRoleRow.state){\n                    popup(\"您没有更改内容\",\"warning\")\n                    return\n                }\n                edit_role(this.editRoleForm).then(res=>{\n                    res=res.data\n                    if (res.code==200){\n                        popup(\"操作成功\")\n                        this.editRoleForm={}\n                        this.editRoleRow={}\n                        this.dialogVisible=false\n                        this.roleSearchForm.state='0'\n                        this.init()\n                    }else {\n                        popup(res.msg, \"error\")\n                    }\n                })\n            },\n            /*修改角色重置按钮*/\n            resetEditForm() {\n                this.editRoleForm={...this.editRoleRow}\n            },\n            /*创建新角色*/\n            submitNewForm(formName){\n                this.$refs[formName].validate((valid) => {\n                    if (valid) {\n                        console.log(this.newRoleForm)\n                        save_role(this.newRoleForm).then(res=>{\n                            res=res.data\n                            if (res.code==200){\n                                popup(\"操作成功\")\n                                this.newRoleForm={}\n                                this.newRoleVisable=false\n                                this.init()\n                            }else {\n                                popup(res.msg, \"error\")\n                            }\n                        })\n                    }\n                });\n            },\n            resetNewForm(){\n                this.newRoleForm={}\n            },\n            /*职能分配*/\n            /*授权按钮*/\n            checkPermissons(rid){\n                this.distributionFulForm.rid=rid\n                this.default_checked_mid=[]\n                checkPermissons(rid).then(res=>{\n                    res=res.data\n                    if (res.code == 200) {\n                        popup(\"操作成功\")\n                        this.fuloptions=res.data.menus\n                        this.default_checked_mid=res.data.menuIds.sort((x,y)=>x-y)\n                        console.log(typeof this.default_checked_mid)\n                        console.log(this.default_checked_mid)\n                    } else {\n                        popup(res.msg, \"error\")\n                    }\n                })\n\n                this.distributionFulVisable=true;\n            },\n            submitDistributionFulForm(){\n                var keys=this.$refs.tree.getCheckedKeys();\n                var v=JSON.stringify(keys).replace(\"[\",\"\").replace(\"]\",\"\")\n                this.distributionFulForm.menuIds=v\n                console.log(this.distributionFulForm.menuIds)\n                saveRolePermissons(this.distributionFulForm).then(res=>{\n                    res=res.data\n                    if (res.code==200){\n                        popup(\"操作成功\")\n                        this.distributionFulVisable=false\n                        this.distributionFulForm={}\n                        this.default_checked_mid=[]\n                        this.fuloptions=[]\n                    }else {\n                        popup(res.msg, \"error\")\n                    }\n                })\n                this.distributionFulVisable=false\n            },\n            celDistributionFul(){\n                this.default_checked_mid=[]\n                this.fuloptions=[]\n                this.distributionFulForm={}\n                this.distributionFulVisable=false\n            }\n\n\n        },\n        created() {\n            this.init()\n        }\n\n    }\n</script>\n<style>\n    .search {\n        display: inline-block;\n        margin: 0 auto;\n        height: 51px;\n        line-height: 51px;\n    }\n\n    .search .column {\n        display: inline-block;\n        margin: 0 auto;\n        margin-right: 2px;\n        line-height: 48px;\n        height: 51px;\n    }\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}